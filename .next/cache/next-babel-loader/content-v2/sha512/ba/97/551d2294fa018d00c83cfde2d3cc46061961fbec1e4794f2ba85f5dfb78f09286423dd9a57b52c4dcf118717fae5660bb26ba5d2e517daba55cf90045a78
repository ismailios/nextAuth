{"ast":null,"code":"import { getSession } from \"next-auth/dist/client\";\nimport { hachPassword, verifyPassword } from \"../../../lib/auth\";\nimport { connectToDB } from \"../../../lib/db\";\n\nasync function hundler(req, res) {\n  const {\n    oldPassword,\n    newPassword\n  } = req.body;\n\n  if (req.method !== \"PATCH\") {\n    return;\n  }\n\n  const session = await getSession({\n    req: req\n  });\n\n  if (!session) {\n    res.status(401).json({\n      message: \"Not Authenticate !!!\"\n    });\n    return;\n  }\n\n  const client = await connectToDB();\n  const usersCollection = client.db().collection(\"users\");\n  const user = await usersCollection.findOne({\n    email: session.user.email\n  });\n\n  if (!user) {\n    res.status(404).json({\n      message: \"User not Found ! \"\n    });\n    client.close();\n    return;\n  }\n\n  const passwordIsEquals = await verifyPassword(oldPassword, user.password);\n\n  if (!passwordIsEquals) {\n    res.status(401).json({\n      message: \"Password Incorrect\"\n    });\n    client.close();\n    return;\n  }\n\n  const updatedpassword = await hachPassword(newPassword);\n  const result = await user.updateOne({\n    email: user.email\n  }, {\n    $set: {\n      password: updatedpassword\n    }\n  });\n  res.status(201).json({\n    message: \"Updated Successfully !!\",\n    user: user\n  });\n  client.close();\n}\n\nexport default hundler;","map":{"version":3,"sources":["C:/Users/HP/Desktop/nextAuth/pages/api/user/change-password.js"],"names":["getSession","hachPassword","verifyPassword","connectToDB","hundler","req","res","oldPassword","newPassword","body","method","session","status","json","message","client","usersCollection","db","collection","user","findOne","email","close","passwordIsEquals","password","updatedpassword","result","updateOne","$set"],"mappings":"AAAA,SAASA,UAAT,QAA2B,uBAA3B;AACA,SAASC,YAAT,EAAuBC,cAAvB,QAA6C,mBAA7C;AACA,SAASC,WAAT,QAA4B,iBAA5B;;AAGA,eAAeC,OAAf,CAAuBC,GAAvB,EAA2BC,GAA3B,EAAgC;AAE9B,QAAM;AAACC,IAAAA,WAAD;AAAaC,IAAAA;AAAb,MAA4BH,GAAG,CAACI,IAAtC;;AAEA,MAAIJ,GAAG,CAACK,MAAJ,KAAe,OAAnB,EAA4B;AAC1B;AACD;;AAED,QAAMC,OAAO,GAAG,MAAMX,UAAU,CAAC;AAAEK,IAAAA,GAAG,EAAEA;AAAP,GAAD,CAAhC;;AAEA,MAAI,CAACM,OAAL,EAAc;AACZL,IAAAA,GAAG,CAACM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,MAAAA,OAAO,EAAE;AADU,KAArB;AAGA;AACD;;AAME,QAAMC,MAAM,GAAG,MAAMZ,WAAW,EAAhC;AAEA,QAAMa,eAAe,GAAGD,MAAM,CAACE,EAAP,GAAYC,UAAZ,CAAuB,OAAvB,CAAxB;AAEA,QAAMC,IAAI,GAAI,MAAMH,eAAe,CAACI,OAAhB,CAAwB;AAACC,IAAAA,KAAK,EAACV,OAAO,CAACQ,IAAR,CAAaE;AAApB,GAAxB,CAApB;;AAEA,MAAG,CAACF,IAAJ,EAAU;AACRb,IAAAA,GAAG,CAACM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,MAAAA,OAAO,EAAE;AADU,KAArB;AAGAC,IAAAA,MAAM,CAACO,KAAP;AACA;AACD;;AAEA,QAAMC,gBAAgB,GAAG,MAAMrB,cAAc,CAACK,WAAD,EAAaY,IAAI,CAACK,QAAlB,CAA7C;;AAEA,MAAG,CAACD,gBAAJ,EAAsB;AAEpBjB,IAAAA,GAAG,CAACM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,MAAAA,OAAO,EAAE;AADU,KAArB;AAIAC,IAAAA,MAAM,CAACO,KAAP;AACA;AACD;;AAED,QAAMG,eAAe,GAAG,MAAMxB,YAAY,CAACO,WAAD,CAA1C;AAEF,QAAMkB,MAAM,GAAK,MAAMP,IAAI,CAACQ,SAAL,CACnB;AAAEN,IAAAA,KAAK,EAACF,IAAI,CAACE;AAAb,GADmB,EAEnB;AAAEO,IAAAA,IAAI,EAAE;AAAEJ,MAAAA,QAAQ,EAAEC;AAAZ;AAAR,GAFmB,CAAvB;AAOCnB,EAAAA,GAAG,CAACM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,IAAAA,OAAO,EAAG,yBADS;AAEnBK,IAAAA,IAAI,EAAGA;AAFY,GAArB;AAKAJ,EAAAA,MAAM,CAACO,KAAP;AAGJ;;AAGD,eAAelB,OAAf","sourcesContent":["import { getSession } from \"next-auth/dist/client\";\r\nimport { hachPassword, verifyPassword } from \"../../../lib/auth\";\r\nimport { connectToDB } from \"../../../lib/db\";\r\n\r\n\r\nasync function hundler(req,res) {\r\n  \r\n  const {oldPassword,newPassword} = req.body\r\n  \r\n  if (req.method !== \"PATCH\") {\r\n    return;\r\n  }\r\n\r\n  const session = await getSession({ req: req });\r\n\r\n  if (!session) {\r\n    res.status(401).json({\r\n      message: \"Not Authenticate !!!\",\r\n    });\r\n    return;\r\n  }\r\n\r\n \r\n\r\n\r\n\r\n     const client = await connectToDB();\r\n\r\n     const usersCollection = client.db().collection(\"users\");\r\n\r\n     const user  = await usersCollection.findOne({email:session.user.email})\r\n\r\n     if(!user) {\r\n       res.status(404).json({\r\n         message :\"User not Found ! \"\r\n       })\r\n       client.close()\r\n       return \r\n     }\r\n\r\n      const passwordIsEquals = await verifyPassword(oldPassword,user.password)\r\n\r\n      if(!passwordIsEquals) {\r\n\r\n        res.status(401).json({\r\n          message: \"Password Incorrect\"\r\n        })\r\n\r\n        client.close()\r\n        return\r\n      }\r\n\r\n      const updatedpassword = await hachPassword(newPassword)\r\n\r\n    const result =   await user.updateOne(\r\n        { email:user.email},\r\n        { $set: { password: updatedpassword } }\r\n     );\r\n\r\n    \r\n\r\n     res.status(201).json({\r\n       message : \"Updated Successfully !!\",\r\n       user : user\r\n     })\r\n\r\n     client.close()\r\n\r\n\r\n}\r\n\r\n\r\nexport default hundler"]},"metadata":{},"sourceType":"module"}